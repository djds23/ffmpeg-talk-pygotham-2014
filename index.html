<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>A Primer on FFmpeg and Video Compression</title><meta name="generator" content="Hovercraft! 1.0 http://regebro.github.com/hovercraft"></meta><meta name="author" content="Dean Silfen"></meta><meta name="description" content="Some quick words on how to compress video for the internet."></meta><meta name="keywords" content="presentation, restructuredtext, impress.js, tutorial"></meta><link rel="stylesheet" href="css/hovercraft.css" media="all"></link><link rel="stylesheet" href="css/impressConsole.css" media="all"></link><link rel="stylesheet" href="css/highlight.css" media="all"></link><link rel="stylesheet" href="main.css" media="screen,projection"></link></head><body class="impress-not-supported"><div id="impress"><div class="step" step="0" data-x="0" data-y="0"><h1 id="a-primer-on-ffmpeg-and-video-compression">A Primer on FFmpeg and Video Compression</h1><h2 id="by-dean-silfen">By Dean Silfen</h2><p><a href="https://github.com/djds23">Github</a> &amp; <a href="https://www.linkedin.com/pub/dean-silfen/50/327/339">LinkedIn</a></p></div><div class="step" step="1" data-x="1600" data-y="0"><h1 id="a-bigapplepy-thanks">A BigApplePy Thanks!</h1><p>Thank you to the BigApplePy Organisers, Volunteers and Sponsors!</p><p>Thank you to all the maintaners of open source projects like FFmpeg, PIL, Pillow, and Mediainfo!</p><p>Thank you to Zulko for MoviePy and his help in my research!</p></div><div class="step" step="2" data-x="3200" data-y="0"><h1 id="anatomy-of-your-average-video-file">Anatomy of your average video file:</h1><p>Container (File suffix, .mp4, .ogg, .webm)</p><blockquote><p>-Video Codec: Theora / VP8 / h.264</p><p>-Audio Codec: Vorbis / MP3 / AAC</p><p>-General Metadata: Format, Writing Library, filesize, etc.</p></blockquote></div><div class="step" step="3" data-x="4800" data-y="0"><h1 id="lossy-vs-lossless-compression">Lossy vs Lossless Compression</h1></div><div class="step" step="4" data-x="6400" data-y="0"><h1 id="group-of-picture-compression">Group of Picture Compression</h1><p>Make smaller videos by recycling data from past and future frames.</p><blockquote><ul><li>Divide the video into 3 different types of frames.<blockquote><ul><li><em>I</em>-frames (key frames) contain all data needed to recreate an image. An I-frame stands alone as a complete image with no data missing.</li><li><em>P</em>-frames (predicted frames) are  partial images that <em>reference</em> other P or I frames before them to create full images.</li><li><em>B</em> frames (bi-directional frames) partial images that draw data from the P and I frames in either direction to make them whole</li></ul></blockquote></li><li><em>P</em> &amp; <em>B</em> frames are both versions of interframe compression while <em>I</em> frames are versions of intraframe compression</li></ul></blockquote></div><div class="step" step="5" data-x="8000" data-y="0"><h1 id="which-codecs-to-chose">Which codecs to chose?</h1></div><div class="step" step="6" data-x="9600" data-y="0"><h1 id="h-264-non-free">h.264! (non-free)</h1><h1 id="vpx-royalty-free">VPX! (royalty-free!)</h1><h1 id="theora-bsd-style-license">Theora! (BSD-style License)</h1></div><div class="step" step="7" data-x="11200" data-y="0"><h1 id="tools">Tools?</h1><p><a href="https://www.ffmpeg.org/">FFmpeg</a>
<a href="http://mediaarea.net/en/MediaInfo">Mediainfo</a>
<a href="http://zulko.github.io/moviepy/">Moviepy</a> (numpy, PIL, Wand, FFMPEG &amp; more!)</p></div><div class="step" step="8" data-x="12800" data-y="0"><h1 id="when-making-ffmpeg-scripts-beware-of-the-internet">When making FFmpeg scripts, beware of the internet!</h1><p>Searching a particular use case does not always yield the best results for FFmpeg!</p><p>Be careful about copying and pasting a command from the internet!</p><p>It is generally best to look directly at the FFmpeg documents!</p></div><div class="step" step="9" data-x="14400" data-y="0"><h1 id="basic-input">Basic input:</h1><p>Your typical FFmpeg script looks like this:</p><p><tt>ffmpeg -i input.mp4 -c:a copy -c:v copy output.mp4</tt></p><p>The <tt>-c:a</tt> and <tt>-c:v</tt> stand for audio and videos codecs respectively.</p></div><div class="step" step="10" data-x="16000" data-y="0"><h1 id="more-advanced-input">More advanced input:</h1><pre class="highlight ">-s (size)
-f (format)
-v (verbosity)
-r (framerate)
-t (duration in seconds)
-metadata (key=value)
-frames:v (limit number of frames)
-an (no audio)
-vn (no video)
-y (overwrite existing video without prompts)
-pix_fmt (used to accomadate colorspace)</pre></div><div class="step" step="11" data-x="17600" data-y="0"><h1 id="slightly-more-complex-commands">Slightly more complex commands!</h1><p>Here is an example script for simply converting a file to h.264</p><pre class="highlight ">ffmpeg -i input.mp4 -c:a copy -c:v libx264 -r 24 -frames:v 24 output.mp4</pre></div><div class="step" step="12" data-x="19200" data-y="0"><h1 id="presets">Presets</h1><p>Trust in the presets! They are there for a reason!</p><p>Take a look at them here:</p><p><a href="https://trac.ffmpeg.org/wiki/x264EncodingGuide">FFmpeg X264 Encoding Guide</a></p><p><tt>-presets (option)</tt> will set up your encoding preset</p><p><tt>-tune (option)</tt> cater to your specific video, animation, film, fastdecode</p></div><div class="step" step="13" data-x="20800" data-y="0"><h1 id="lets-build-more-complex-commands">Lets build more complex commands!</h1><p>We have a rawvideo file that came from a capture, this file is quite large and will not play properly in all players. Lets transcode it to h.264 to make it smaller!</p></div><div class="step" step="14" data-x="22400" data-y="0"><pre class="highlight ">ffmpeg\
-y\
-f rawvideo\
-c:v rawvideo\
-pix_fmt rgb24\
-r 60\
-i input.mp4\
-preset slow\
-an\
-c:v libx264\
-pix_fmt yuv420p\
-r 24\
output.mp4</pre></div><div class="step" step="15" data-x="24000" data-y="0"><h1 id="now-lets-inspect-our-video-alittle-bit">Now lets inspect our video alittle bit</h1><p>Using mediainfo we can read out the information held in the container of the file.</p><pre class="highlight ">General
Complete name                            : output.mp4
Format                                   : MPEG-4
Format profile                           : Base Media</pre><p>...</p><pre class="highlight ">Video
ID                                       : 1
Format                                   : AVC
Format/Info                              : Advanced Video Codec</pre></div><div class="step" step="16" data-x="25600" data-y="0"><p>Mediainfo continued...</p><pre class="highlight ">Width                                    : 1 280 pixels
Height                                   : 720 pixels
Display aspect ratio                     : 16:9
Frame rate mode                          : Constant
Frame rate                               : 24.000 fps
Color space                              : YUV
Chroma subsampling                       : 4:2:0
Bit depth                                : 8 bits
Scan type                                : Progressive
Writing library                          : x264 core 142</pre><p>Looks pretty good right?</p></div><div class="step" step="17" data-x="27200" data-y="0"><h1 id="now-lets-starting-building-videos-with-python">Now lets starting building videos with Python!</h1></div><div class="step" step="18" data-x="28800" data-y="0"><p><tt>pip install moviepy</tt></p><p>This will take a while! numpy is quite a large dependency.</p></div><div class="step" step="19" data-x="30400" data-y="0"><h1 id="what-is-moviepy-exactly-and-what-can-i-do-with-it">What is MoviePy exactly and what can I do with it?</h1><img src="media/explanations.jpeg" alt="" width="" height=""></img></div><div class="step" step="20" data-x="32000" data-y="0"><p>Hello, World!</p><pre class="highlight code python"><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">moviepy.editor</span> <span class="kn">as</span> <span class="nn">moviepy</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">hello_world</span> <span class="o">=</span> <span class="n">TextClip</span><span class="p">(</span><span class="s">'Hello, World!'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">78</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'white'</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">1280</span><span class="p">,</span><span class="mi">720</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">hello_world</span> <span class="o">=</span> <span class="n">hello_world</span><span class="o">.</span><span class="n">set_pos</span><span class="p">(</span><span class="s">'center'</span><span class="p">)</span><span class="o">.</span><span class="n">set_duration</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">hello_world</span><span class="o">.</span><span class="n">write_videofile</span><span class="p">(</span><span class="s">'hello_world.avi'</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span></pre><p>you can replace the last line with <tt>write_videofile('hello_world.webm', fps=24, codec=libvpx</tt> and it will still work!</p></div><div class="step" step="21" data-x="33600" data-y="0"><video src="media/hello_world.webm" alt="" width="" height=""></video></div><div class="step" step="22" data-x="35200" data-y="0"><h1 id="generate-graphic-elements-with-moviepy">Generate graphic elements with MoviePy</h1><p>Lets say we have formatted text that we want to make a slideshow out of, why not use moviepy?</p><p>Say these were Tweets? How would we do that?</p></div><div class="step" step="23" data-x="36800" data-y="0"><p>Big thanks to Zulko for the next two slides!</p><p>Lets assume we have an array of tweets...</p><pre class="highlight code python"><span class="n">texts</span> <span class="o">=</span> <span class="p">[</span><span class="n">moviepy</span><span class="o">.</span><span class="n">TextClip</span><span class="p">(</span><span class="n">tweet</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">23</span><span class="p">,</span>
                  <span class="n">font</span><span class="o">=</span><span class="s">"Amiri-Bold"</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s">"center"</span><span class="p">)</span>
        <span class="o">.</span><span class="n">set_duration</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tweet</span><span class="p">)</span><span class="o">*.</span><span class="mo">065</span><span class="p">)</span>
        <span class="o">.</span><span class="n">set_pos</span><span class="p">(</span><span class="s">"center"</span><span class="p">)</span>
        <span class="o">.</span><span class="n">crossfadein</span><span class="p">(</span><span class="o">.</span><span class="mi">2</span><span class="p">)</span>
        <span class="o">.</span><span class="n">crossfadeout</span><span class="p">(</span><span class="o">.</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">tweets</span><span class="p">]</span></pre><p>Now we have a list of TextClip objects that have nice fades on them!</p><p>Also note the use of fonts, they come with ImageMagick.</p></div><div class="step" step="24" data-x="38400" data-y="0"><p>More code...</p><pre class="highlight code python"><span class="n">textclips</span> <span class="o">=</span> <span class="p">[</span><span class="n">moviepy</span><span class="o">.</span><span class="n">CompositeVideoClip</span><span class="p">(</span>
               <span class="p">[</span><span class="n">signature</span><span class="p">,</span> <span class="n">text</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="n">SIZE</span><span class="p">,</span> <span class="n">bg_color</span><span class="o">=</span><span class="p">(</span><span class="mi">233</span><span class="p">,</span><span class="mi">229</span><span class="p">,</span><span class="mi">90</span><span class="p">))</span>
              <span class="o">.</span><span class="n">set_duration</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">duration</span><span class="p">)</span>
             <span class="k">for</span> <span class="n">text</span> <span class="ow">in</span> <span class="n">texts</span><span class="p">]</span></pre><p>CompositeVideoClips feature the text on top of a nice banana yello background.</p><pre class="highlight code python"><span class="n">final</span> <span class="o">=</span> <span class="n">moviepy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">textclips</span><span class="p">)</span></pre><p>This joins all the clips to one CompositeVideoClip object, joined one after another.</p><pre class="highlight code python"><span class="n">final</span><span class="o">.</span><span class="n">write_videofile</span><span class="p">(</span><span class="s">'output.mp4'</span><span class="p">)</span></pre><p>and we write the output to a file!</p></div><div class="step" step="25" data-x="40000" data-y="0"><h1 id="how-do-we-actually-output-to-a-file">How do we actually output to a file?</h1><p>Take a peak at <tt>moviepy/video/io/ffmpeg_writer.py</tt>.</p><p>Does this look familiar?</p><pre class="highlight code python"><span class="n">cmd</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">[</span> <span class="n">FFMPEG_BINARY</span><span class="p">,</span> <span class="s">'-y'</span><span class="p">,</span>
        <span class="s">"-loglevel"</span><span class="p">,</span> <span class="s">"error"</span> <span class="k">if</span> <span class="n">logfile</span><span class="o">==</span><span class="n">sp</span><span class="o">.</span><span class="n">PIPE</span> <span class="k">else</span> <span class="s">"info"</span><span class="p">,</span>
        <span class="s">"-f"</span><span class="p">,</span> <span class="s">'rawvideo'</span><span class="p">,</span>
        <span class="s">"-vcodec"</span><span class="p">,</span><span class="s">"rawvideo"</span><span class="p">,</span>
        <span class="s">'-s'</span><span class="p">,</span> <span class="s">"</span><span class="si">%d</span><span class="s">x</span><span class="si">%d</span><span class="s">"</span><span class="o">%</span><span class="p">(</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="s">'-pix_fmt'</span><span class="p">,</span> <span class="s">"rgba"</span> <span class="k">if</span> <span class="n">withmask</span> <span class="k">else</span> <span class="s">"rgb24"</span><span class="p">,</span>
        <span class="s">'-r'</span><span class="p">,</span> <span class="s">"</span><span class="si">%.02f</span><span class="s">"</span><span class="o">%</span><span class="n">fps</span><span class="p">,</span>
        <span class="s">'-i'</span><span class="p">,</span> <span class="s">'-'</span><span class="p">,</span> <span class="s">'-an'</span><span class="p">,</span>
        <span class="s">'-vcodec'</span><span class="p">,</span> <span class="n">codec</span><span class="p">,</span>
        <span class="s">'-preset'</span><span class="p">,</span> <span class="n">preset</span><span class="p">]</span>
        <span class="o">+</span> <span class="p">([</span><span class="s">'-b'</span><span class="p">,</span><span class="n">bitrate</span><span class="p">]</span> <span class="k">if</span> <span class="p">(</span><span class="n">bitrate</span><span class="o">!=</span><span class="bp">None</span><span class="p">)</span> <span class="k">else</span> <span class="p">[])</span>

        <span class="c"># http://trac.ffmpeg.org/ticket/658</span>
        <span class="o">+</span> <span class="p">([</span><span class="s">'-pix_fmt'</span><span class="p">,</span> <span class="s">'yuv420p'</span><span class="p">]</span>
              <span class="k">if</span> <span class="p">((</span><span class="n">codec</span> <span class="o">==</span> <span class="s">'libx264'</span><span class="p">)</span> <span class="ow">and</span>
                 <span class="p">(</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">%</span><span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span>
                 <span class="p">(</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">%</span><span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span>
           <span class="k">else</span> <span class="p">[])</span>
        <span class="o">+</span> <span class="p">[</span> <span class="s">'-r'</span><span class="p">,</span> <span class="s">"</span><span class="si">%d</span><span class="s">"</span><span class="o">%</span><span class="n">fps</span><span class="p">,</span> <span class="n">filename</span> <span class="p">]</span>
        <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">proc</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">stdin</span><span class="o">=</span><span class="n">sp</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                              <span class="n">stderr</span><span class="o">=</span><span class="n">logfile</span><span class="p">,</span>
                              <span class="n">stdout</span><span class="o">=</span><span class="n">DEVNULL</span><span class="p">)</span></pre></div><div class="step" step="26" data-x="41600" data-y="0"><p>Can we apply this to an application?</p><pre class="highlight code python"><span class="kn">import</span> <span class="nn">textwrap</span>
<span class="kn">import</span> <span class="nn">moviepy.editor</span> <span class="kn">as</span> <span class="nn">moviepy</span>

<span class="k">def</span> <span class="nf">make_element</span><span class="p">(</span><span class="n">quote</span><span class="p">,</span> <span class="n">author</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
<span class="n">signature</span> <span class="o">=</span> <span class="p">(</span><span class="n">moviepy</span><span class="o">.</span><span class="n">TextClip</span><span class="p">(</span><span class="s">"- </span><span class="si">%s</span><span class="s">"</span><span class="o">%</span><span class="n">author</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
                           <span class="n">color</span><span class="o">=</span><span class="s">'gray'</span><span class="p">,)</span>
                           <span class="c">#font="Amiri-Slanted")</span>
              <span class="o">.</span><span class="n">margin</span><span class="p">(</span><span class="n">right</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
              <span class="o">.</span><span class="n">set_pos</span><span class="p">((</span><span class="s">"right"</span><span class="p">,</span><span class="s">"bottom"</span><span class="p">)))</span>
<span class="n">quote</span> <span class="o">=</span> <span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">quote</span><span class="p">))</span>
<span class="n">quote_clip</span> <span class="o">=</span> <span class="p">(</span><span class="n">moviepy</span><span class="o">.</span><span class="n">TextClip</span><span class="p">(</span><span class="n">quote</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">23</span><span class="p">,</span>
                      <span class="n">font</span><span class="o">=</span><span class="s">"Amiri-Bold"</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s">"center"</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">set_duration</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">quote</span><span class="p">)</span><span class="o">*.</span><span class="mo">065</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">set_pos</span><span class="p">(</span><span class="s">"center"</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">crossfadein</span><span class="p">(</span><span class="o">.</span><span class="mi">2</span><span class="p">)</span>
                        <span class="o">.</span><span class="n">crossfadeout</span><span class="p">(</span><span class="o">.</span><span class="mi">2</span><span class="p">))</span>
<span class="n">element</span> <span class="o">=</span> <span class="p">(</span><span class="n">moviepy</span><span class="o">.</span><span class="n">CompositeVideoClip</span><span class="p">(</span>
               <span class="p">[</span><span class="n">signature</span><span class="p">,</span> <span class="n">quote_clip</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">bg_color</span><span class="o">=</span><span class="p">(</span><span class="mi">233</span><span class="p">,</span><span class="mi">229</span><span class="p">,</span><span class="mi">90</span><span class="p">))</span>
                <span class="o">.</span><span class="n">set_duration</span><span class="p">(</span><span class="n">quote_clip</span><span class="o">.</span><span class="n">duration</span><span class="p">))</span>
<span class="k">return</span> <span class="n">element</span></pre></div><div class="step" step="27" data-x="43200" data-y="0"><p>Why not?</p><pre class="highlight code python"><span class="n">author</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s">'author'</span><span class="p">]</span>
<span class="n">quote</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s">'quote'</span><span class="p">]</span>
<span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s">'width'</span><span class="p">]),</span><span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s">'height'</span><span class="p">]))</span>
<span class="n">element</span> <span class="o">=</span> <span class="n">make_element</span><span class="p">(</span><span class="n">quote</span><span class="p">,</span> <span class="n">author</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
<span class="n">destination</span> <span class="o">=</span> <span class="s">'static'</span>
<span class="n">supported_codecs</span> <span class="o">=</span> <span class="p">[(</span><span class="s">'libx264'</span><span class="p">,</span> <span class="s">'.mp4'</span><span class="p">),</span>
                    <span class="p">(</span><span class="s">'libvpx'</span><span class="p">,</span><span class="s">'.webm'</span><span class="p">),</span>
                    <span class="p">(</span><span class="s">'libtheora'</span><span class="p">,</span><span class="s">'.ogg'</span><span class="p">)]</span>
<span class="n">context</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">codec</span> <span class="ow">in</span> <span class="n">supported_codecs</span><span class="p">:</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">author</span> <span class="o">+</span> <span class="n">codec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">element</span><span class="o">.</span><span class="n">write_videofile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span>
                            <span class="n">codec</span><span class="o">=</span><span class="n">codec</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                            <span class="n">fps</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">destination</span><span class="p">)</span>
    <span class="n">context</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s">'filename'</span> <span class="p">:</span> <span class="n">filename</span><span class="p">,</span>
                    <span class="s">'suffix'</span><span class="p">:</span> <span class="n">codec</span><span class="p">[</span><span class="mi">1</span><span class="p">]})</span>
<span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'video.html'</span><span class="p">,</span> <span class="n">videos</span><span class="o">=</span><span class="n">context</span><span class="p">)</span></pre></div><div class="step" step="28" data-x="44800" data-y="0"><video src="media/text_element.webm" alt="" width="" height=""></video></div><div class="step" step="29" data-x="46400" data-y="0"><p>A prettier Twitter example using PIL and moviepy, take a peak at the code <a href="https://github.com/djds23/element_gen">here</a>!</p></div><div class="step" step="30" data-x="48000" data-y="0"><video src="media/dontusethiscode_large.webm" alt="" width="" height=""></video></div><div class="step" step="31" data-x="49600" data-y="0"><h1 id="advanced-ffmpeg-lets-get-crf-ty">Advanced FFmpeg, Lets get CRF-ty</h1><p>Bandwidth can be expensive, use these methods to trim your bitrate!</p><p>Constant Rate Factor compress similar frames a similar amount.</p><pre class="highlight ">-crf (quantization number between 0 for best quality and 51 for worst)</pre><p>Multipass encoding creates a reference file for better look ahead data!</p><pre class="highlight ">-pass 1 (first pass)
-pass 2 (second pass)</pre><p>Combine this with <tt>-b:v (bitrate)</tt> for a target bitrate to compress video for best results.</p></div><div class="step" step="32" data-x="51200" data-y="0"><h1 id="filters">Filters</h1><p><tt>-vf</tt> applies a video filter</p><p><tt>scale:width:height:flags=lanczos</tt> for more effcient resizing</p><p><tt>yadif=0:-1:0</tt> yet another deinterlacing filter...</p></div><div class="step" step="33" data-x="52800" data-y="0"><h1 id="libx264-bindings-vs-ffmpeg-bindings">libx264 bindings vs FFmpeg bindings</h1><p>libx264 has more options than FFmpeg has flags!</p><p><tt>-x264opts (key=value:key=value)</tt></p></div><div class="step" step="34" data-x="54400" data-y="0"><h1 id="experiment">Experiment!</h1><p>Inspect your videos using a tool like Mediainfo, and see what your presets did, then tweak accordingly.</p></div><div class="step" step="35" data-x="56000" data-y="0"><h1 id="fun-use-cases">Fun use cases</h1><p><tt>-v:c prores -profile:v 1</tt> creates edit friendly prores files!</p><p><tt>-vf scale:612:612:flags=lanczos</tt> for instagram!</p><p>Recoding video from a webcam with <tt>-i /dev/video0</tt></p><p>Create a streaming server with ffserver! (Linux only!)</p></div><div class="step" step="36" data-x="57600" data-y="0"><h1 id="links-references">Links/References</h1><p>-<a href="http://zulko.github.io/moviepy">http://zulko.github.io/moviepy</a></p><p>-<a href="http://www.theora.org/">http://www.theora.org/</a></p><p>-<a href="http://www.webmproject.org/">http://www.webmproject.org/</a></p><p>-<a href="http://trac.ffmpeg.org/wiki/CompilationGuide">http://trac.ffmpeg.org/wiki/CompilationGuide</a></p><p>-<a href="https://trac.ffmpeg.org/wiki/x264EncodingGuide">https://trac.ffmpeg.org/wiki/x264EncodingGuide</a></p><p>-<a href="http://www.ffmpeg.org/ffmpeg-all.html">http://www.ffmpeg.org/ffmpeg-all.html</a></p><p>-<a href="https://trac.ffmpeg.org/wiki/vpxEncodingGuide">https://trac.ffmpeg.org/wiki/vpxEncodingGuide</a></p><p>-<a href="https://trac.ffmpeg.org/wiki/Streaming%20media%20with%20ffserver">https://trac.ffmpeg.org/wiki/Streaming%20media%20with%20ffserver</a></p><p>-<a href="http://avisynth.org.ru/yadif/yadif.html">http://avisynth.org.ru/yadif/yadif.html</a></p><p>-<a href="http://documentation.apple.com/en/finalcutpro/usermanual/index.html#chapter=C%26section=12%26tasks=true">http://documentation.apple.com/en/finalcutpro/usermanual/index.html#chapter=C%26section=12%26tasks=true</a></p><p>-<a href="http://www.xiph.org/video/vid1.shtml">http://www.xiph.org/video/vid1.shtml</a></p><p>-<a href="http://flask.pocoo.org/">http://flask.pocoo.org/</a></p></div></div><div id="hovercraft-help"><table><tr><th>Space</th><td>Forward</td></tr><tr><th>Left, Down, Page Down</th><td>Next slide</td></tr><tr><th>Right, Up, Page Up</th><td>Previous slide</td></tr><tr><th>P</th><td>Open presenter console</td></tr><tr><th>H</th><td>Toggle this help</td></tr></table></div><script type="text/javascript" src="js/impress.js"></script><script type="text/javascript" src="js/impressConsole.js"></script><script type="text/javascript" src="js/hovercraft.js"></script></body></html>
