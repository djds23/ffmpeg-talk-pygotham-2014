<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>A Primer on FFmpeg and Video Compression</title><meta name="generator" content="Hovercraft! 1.0 http://regebro.github.com/hovercraft"></meta><meta name="author" content="Dean Silfen"></meta><meta name="description" content="Some quick words on how to compress video for the internet."></meta><meta name="keywords" content="presentation, restructuredtext, impress.js, tutorial"></meta><link rel="stylesheet" href="css/hovercraft.css" media="all"></link><link rel="stylesheet" href="css/impressConsole.css" media="all"></link><link rel="stylesheet" href="css/highlight.css" media="all"></link><link rel="stylesheet" href="main.css" media="all"></link><link rel="stylesheet" href="main.css" media="screen,projection"></link></head><body class="impress-not-supported"><div id="impress"><div class="step" step="0" data-x="0" data-y="0"><h1 id="a-primer-on-ffmpeg-and-video-compression">A Primer on FFmpeg and Video Compression</h1><h2 id="by-dean-silfen">By Dean Silfen</h2></div><div class="step" step="1" data-x="1600" data-y="0"><h1 id="lossy-vs-lossless">Lossy vs Lossless</h1></div><div class="step" step="2" data-x="3200" data-y="0"><h1 id="group-of-picture-compression">Group of Picture Compression</h1><p>Make smaller videos by recycling data from past and future frames.</p><blockquote><ul><li>Divide the video into 3 different types of frames.<blockquote><ul><li><em>I</em>-frames (key frames) contain all data needed to recreate an image. An I-frame stands alone as a complete image with no data missing.</li><li><em>P</em>-frames (predicted frames) are  partial images that <em>reference</em> other P or I frames before them to create full images.</li><li><em>B</em> frames (bi-directional frames) partial images that draw data from the P and I frames in either direction to make them whole</li></ul></blockquote></li><li><em>P</em> &amp; <em>B</em> frames are both versions of interframe compression while <em>I</em> frames are versions of intraframe compression</li></ul></blockquote></div><div class="step" step="3" data-x="4800" data-y="0"><h1 id="which-codec-to-chose">Which codec to chose?</h1></div><div class="step" step="4" data-x="6400" data-y="0"><h1 id="h-264">h.264!</h1></div><div class="step" step="5" data-x="8000" data-y="0"><h1 id="tools">Tools?</h1><p>The swiss army knife of digital video!</p><p>FFmpeg: <a href="https://www.ffmpeg.org/">https://www.ffmpeg.org/</a></p></div><div class="step" step="6" data-x="9600" data-y="0"><h1 id="how-do-i-do-this">How do I do "this"?</h1><p>Googling a particular use case does not yield the best results!</p><p>Be careful about copying and pasting a command from the internet!</p></div><div class="step" step="7" data-x="11200" data-y="0"><h1 id="basic-input">Basic input:</h1><p>Your typical script looks like this:</p><p><tt>ffmpeg -i input.mp4 -c:a copy -c:v copy output.mp4</tt></p><p>The <tt>-c:a</tt> and <tt>-c:v</tt> stand for audio and videos codecs respectively.</p></div><div class="step" step="8" data-x="12800" data-y="0"><h1 id="basic-input-part-2">Basic input part 2:</h1><pre class="highlight ">-v (verbosity)
-r (framerate)
-t (duration in seconds)
-metadata (key=value)
-frames:v (limit number of frames)
-an (no audio)
-vn (no video)
-y (overwrite existing video without prompts)
-pix_fmt (used to accomadate colorspace)</pre></div><div class="step" step="9" data-x="14400" data-y="0"><h1 id="how-can-i-get-h-264-working">How can I get h.264 working?</h1><p>Libx264 is an excellent encoding/decoding library for h.264 files, and it has bindings with our favorite software!</p><pre class="highlight ">ffmpeg -i input.mp4 -c:a copy -c:v libx264 output.mp4</pre></div><div class="step" step="10" data-x="16000" data-y="0"><h1 id="lets-get-crf-ty">Lets get CRF-ty</h1><p>Bandwidth can be expensive, use these methods to trim your bitrate!</p><p>Constant Rate Factor compress similar frames a similar amount.</p><pre class="highlight ">-crf (quantization number between 0 for best quality and 51 for worst)</pre><p>Multipass encoding creates a reference file for better look ahead data!</p><pre class="highlight ">-pass 1 (first pass)
-pass 2 (second pass)</pre><p>Combine this with <tt>-b:v (bitrate)</tt> for a target bitrate to compress video for best results.</p></div><div class="step" step="11" data-x="17600" data-y="0"><h1 id="presets">Presets</h1><p>Trust in the presets! They are there for a reason!</p><p>Take a look at them here:</p><p><a href="https://trac.ffmpeg.org/wiki/x264EncodingGuide">https://trac.ffmpeg.org/wiki/x264EncodingGuide</a></p><p><tt>-presets (option)</tt> will set up your encoding preset</p><p><tt>-tune (option)</tt> cater to your specific video, animation, film, fastdecode</p></div><div class="step" step="12" data-x="19200" data-y="0"><h1 id="lets-build-more-complex-commands">Lets build more complex commands!</h1><p>You got a 1 minute video? Lets make it 5mb.</p><p>filesize in kilobits / length in seconds = approximate target bitrate</p><p>Subtract audio bitrate from result</p><p>(5*8192)/60 = ~683</p><p>683 - 128 = 555k</p></div><div class="step" step="13" data-x="20800" data-y="0"><pre class="highlight ">ffmpeg\
-i showme.mov\
-an\
-c:v libx264\
-preset slow\
-tune animation\
-pass 1\
-b:v 555k\
-f mp4 /dev/null</pre></div><div class="step" step="14" data-x="22400" data-y="0"><pre class="highlight ">ffmpeg\
-i input.mp4\
-c:v libx264\
-preset slow\
-b:v 555k\
-tune animation\
-pass 2\
-c:a libfaac\
-b:a 128k\
output.mp4</pre></div><div class="step" step="15" data-x="24000" data-y="0"><h1 id="filters">Filters</h1><p><tt>-vf</tt> applies a video filter</p><p><tt>scale:width:height:flags=lanczos</tt> for effcient resizing</p><p><tt>yadif=0:-1:0</tt> yet another deinterlacing filter...</p></div><div class="step" step="16" data-x="25600" data-y="0"><h1 id="libx264-bindings-vs-ffmpeg-bindings">libx264 bindings vs FFmpeg bindings</h1><p>libx264 has more options than FFmpeg has flags!</p><p><tt>-x264opts (key=value:key=value)</tt></p></div><div class="step" step="17" data-x="27200" data-y="0"><h1 id="experiment">Experiment!</h1><p>Inspect your videos using a tool like Mediainfo, and see what your presets did, then tweak accordingly.</p><p><a href="http://mediaarea.net/en/MediaInfo">http://mediaarea.net/en/MediaInfo</a></p></div><div class="step" step="18" data-x="28800" data-y="0"><h1 id="fun-use-cases">Fun use cases</h1><p><tt>-v:c prores -profile:v 1</tt> creates edit friendly prores files!</p><p><tt>-vf scale:612:612:flags=lanczos</tt> for instagram!</p><p>Recoding video from a webcam with <tt>-i /dev/video0</tt></p><p>Create a streaming server with ffserver! (Linux only!)</p></div><div class="step" step="19" data-x="30400" data-y="0"><h1 id="more-codecs">More Codecs!</h1><p>Check out libvpx for efficient webm encoding. Playable on android devices!</p></div><div class="step" step="20" data-x="32000" data-y="0"><h1 id="python">Python?</h1><p>Subprocess module!</p><h2 id="check-out-the-moviepy-library">Check out the MoviePy library!</h2><p>This library handles many of the arguments for you, allowing you to process and edit video straight from Python.</p><p>Guess what it outputs to?</p></div><div class="step" step="21" data-x="33600" data-y="0"><h1 id="links-references">Links/References</h1><p>-<a href="http://trac.ffmpeg.org/wiki/CompilationGuide">http://trac.ffmpeg.org/wiki/CompilationGuide</a></p><p>-<a href="https://trac.ffmpeg.org/wiki/x264EncodingGuide">https://trac.ffmpeg.org/wiki/x264EncodingGuide</a></p><p>-<a href="http://www.ffmpeg.org/ffmpeg-all.html">http://www.ffmpeg.org/ffmpeg-all.html</a></p><p>-<a href="https://trac.ffmpeg.org/wiki/vpxEncodingGuide">https://trac.ffmpeg.org/wiki/vpxEncodingGuide</a></p><p>-<a href="https://trac.ffmpeg.org/wiki/Streaming%20media%20with%20ffserver">https://trac.ffmpeg.org/wiki/Streaming%20media%20with%20ffserver</a></p><p>-<a href="http://avisynth.org.ru/yadif/yadif.html">http://avisynth.org.ru/yadif/yadif.html</a></p><p>-<a href="http://documentation.apple.com/en/finalcutpro/usermanual/index.html#chapter=C%26section=12%26tasks=true">http://documentation.apple.com/en/finalcutpro/usermanual/index.html#chapter=C%26section=12%26tasks=true</a></p><p>-<a href="http://www.xiph.org/video/vid1.shtml">http://www.xiph.org/video/vid1.shtml</a></p></div></div><div id="hovercraft-help"><table><tr><th>Space</th><td>Forward</td></tr><tr><th>Left, Down, Page Down</th><td>Next slide</td></tr><tr><th>Right, Up, Page Up</th><td>Previous slide</td></tr><tr><th>P</th><td>Open presenter console</td></tr><tr><th>H</th><td>Toggle this help</td></tr></table></div><script type="text/javascript" src="js/impress.js"></script><script type="text/javascript" src="js/impressConsole.js"></script><script type="text/javascript" src="js/hovercraft.js"></script></body></html>